#include <DHT.h>

define DHTPIN D4
#define DHTTYPE DHT11

//RELE
#define FAN_PIN D1
#define HUMIDIFIER_PIN D2
#define LED_PIN D3

#define INTERVAL 10

DHT dht(DHTPIN, DHTTYPE);

unsigned long previousMillis = 0;
unsigned long ledOnMillis = 0;
bool ledOn = false;

void setup() {
  pinMode(FAN_PIN, OUTPUT);
  pinMode(HUMIDIFIER_PIN, OUTPUT);
  pinMode(LED_PIN, OUTPUT);
}

void loop() {
  unsigned long currentMillis = millis();
  if (currentMillis - previousMillis >= INTERVAL * 1000) {
    previousMillis = currentMillis;
    float h = dht.readHumidity();
    float t = dht.readTemperature();
    if (h < 70) {
      digitalWrite(FAN_PIN, HIGH);
      digitalWrite(HUMIDIFIER_PIN, HIGH);
    } else if (h > 90) {
      digitalWrite(FAN_PIN, LOW);
      digitalWrite(HUMIDIFIER_PIN, LOW);
    }
    if (currentMillis - ledOnMillis >= 8 * 60 * 60 * 1000) {
      ledOn = !ledOn;
      digitalWrite(LED_PIN, ledOn ? HIGH : LOW);
      ledOnMillis = currentMillis;
    }
    String payload = "{\"temperature\":" + String(t) + ",\"humidity\":" + String(h) + ",\"fan\":" + String(digitalRead(FAN_PIN)) + ",\"humidifier\":" + String(digitalRead(HUMIDIFIER_PIN)) + ",\"led\":" + String(digitalRead(LED_PIN)) + "}";
  }
}
